<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Situaciones para el Parque Tierra</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

    <style>
        body { font-family:'Open Sans',sans-serif;background:#f0f2f5;text-align:center;padding:20px }
        h1 { color:#333 }
        .container { display:flex;justify-content:center;flex-wrap:wrap;margin-top:20px }
        .input-section,.output-section {
            background:#fff;padding:30px;margin:10px;border-radius:8px;max-width:800px;width:100%;
            box-shadow:0 2px 8px rgba(0,0,0,.1);box-sizing:border-box
        }
        .input-group {
            display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
            gap:20px;position:relative
        }
        .input-wrapper { position:relative;text-align:left }
        .input-wrapper label { display:block;font-weight:bold;margin-bottom:5px }
        .input-wrapper input {
            width:100%;padding:10px;border:1px solid #ccc;border-radius:4px;transition:border-color .3s
        }
        .input-wrapper input:focus { border-color:#007bff;outline:none }
        .error-message { color:#e74c3c;font-size:12px;position:absolute;top:100%;left:0 }
        button {
            padding:12px 24px;margin-top:20px;font-size:16px;background:#007bff;color:#fff;
            border:none;border-radius:4px;cursor:pointer;transition:.3s
        }
        button:disabled { background:#6c757d;cursor:not-allowed }
        #questions-list {
            text-align:left;max-height:340px;overflow-y:auto;padding-left:20px
        }
        #questions-list li {
            background:#e9ecef;padding:10px;margin:10px 0;border-radius:4px;font-size:18px
        }
    </style>
</head>

<body>
<h1>Generador de Situaciones para el Parque Tierra</h1>

<div class="container" id="main-content">
    <div class="input-section" id="input-section">

        <h2>¿Cuántos grupos de trabajo hay en la clase?</h2>
        <div class="input-wrapper">
            <label for="num-groups">Número de grupos:</label>
            <input type="number" id="num-groups" min="1" max="50" placeholder="Ingrese el número de grupos">
            <div class="error-message" id="groups-error"></div>
        </div>

        <h2>Ingrese 10 Seres Vivos</h2>
        <div id="beings-input" class="input-group"></div>

        <h2>Ingrese 10 Usos o Relaciones</h2>
        <div id="uses-input" class="input-group"></div>

        <button id="start" disabled>Iniciar</button>
    </div>
</div>

<script>
/* Generar dinámicamente los campos */
document.addEventListener("DOMContentLoaded", ()=>{
    const beingsBox = document.getElementById("beings-input");
    const usesBox   = document.getElementById("uses-input");

    beingsBox.innerHTML = Array.from({length:10},(_,i)=>`
        <div class="input-wrapper">
            <label for="being-${i+1}">Ser vivo ${i+1}</label>
            <input type="text" id="being-${i+1}" class="being-input">
            <div class="error-message"></div>
        </div>`).join("");

    usesBox.innerHTML = Array.from({length:10},(_,i)=>`
        <div class="input-wrapper">
            <label for="use-${i+1}">Uso/Relación ${i+1}</label>
            <input type="text" id="use-${i+1}" class="use-input">
            <div class="error-message"></div>
        </div>`).join("");

    addListeners();
});

/* Variables globales */
let groupOrderFirstRound   = [];
let groupOrderSecondRound  = [];
let currentGroupIndex      = 0;
let questionsMap           = {};
let totalGroups            = 0;

/* Añadir escuchas */
function addListeners(){
    document.querySelectorAll('.being-input').forEach(i=>{
        i.addEventListener('input', ()=>{ validateSet('.being-input','#beings-input'); updateStartButton(); });
    });

    document.querySelectorAll('.use-input').forEach(i=>{
        i.addEventListener('input', ()=>{ validateSet('.use-input','#uses-input'); updateStartButton(); });
    });

    document.getElementById('num-groups').addEventListener('input', ()=>{
        const v=document.getElementById('num-groups').value.trim();
        document.getElementById('groups-error').textContent=(!v || v<1)?'Número no válido.':'';
        updateStartButton();
    });

    document.getElementById('start').addEventListener('click', iniciarProceso);
}

/* Validación sin borrar datos */
function validateSet(selector, container){
    const inputs       = [...document.querySelectorAll(selector)];
    const errorBlocks  = [...document.querySelectorAll(container+' .error-message')];

    const values = new Map();

    inputs.forEach((input,idx)=>{
        const v = input.value.trim().toLowerCase();
        let msg = "";

        if(v!==""){
            if(values.has(v)) msg = "Duplicado.";
            else values.set(v,true);
        }

        errorBlocks[idx].textContent = msg;
    });
}

/* Botón Iniciar */
function updateStartButton(){
    const allBeingsFilled = [...document.querySelectorAll('.being-input')].every(i=>i.value.trim()!=="");
    const allUsesFilled   = [...document.querySelectorAll('.use-input')].every(i=>i.value.trim()!=="");
    const groupsOk        = document.getElementById('num-groups').value.trim()!=="" &&
                            document.getElementById('groups-error').textContent==="";

    const anyError = [...document.querySelectorAll('.error-message')].some(e=>e.textContent!=="");

    document.getElementById('start').disabled = !(allBeingsFilled && allUsesFilled && groupsOk && !anyError);
}

/* Inicio */
function iniciarProceso(){
    const numGroups = parseInt(document.getElementById('num-groups').value);
    if(isNaN(numGroups) || numGroups<1){ alert("Número de grupos no válido."); return; }

    const beings = [...document.querySelectorAll('.being-input')].map(i=>i.value.trim());
    const uses   = [...document.querySelectorAll('.use-input')].map(i=>i.value.trim());

    totalGroups = numGroups;

    const combos = [];
    for(let b of beings) for(let u of uses) combos.push({being:b,use:u});

    shuffleArray(combos);

    const needed = 2*numGroups;
    const selected = combos.slice(0,needed);

    const types = ["¿Es posible","¿Está permitido","¿Resulta aceptable"];
    const questions = selected.map((c,i)=>`${types[i%3]} ${c.use} a un ${c.being}?`);

    shuffleArray(questions);

    const groupNumbers = Array.from({length:numGroups},(_,i)=>i+1);
    questionsMap = {};

    for(let i=0;i<numGroups;i++){
        questionsMap[groupNumbers[i]] = [
            questions[i],
            questions[i+numGroups]
        ];
    }

    groupOrderFirstRound  = [...groupNumbers];
    groupOrderSecondRound = [...groupNumbers];
    shuffleArray(groupOrderFirstRound);
    shuffleArray(groupOrderSecondRound);

    renderQuestionsInterface();
}

/* Pantalla de preguntas */
function renderQuestionsInterface(){
    document.getElementById('main-content').innerHTML = `
        <div class="output-section">
            <h2>Preguntas para los Grupos</h2>

            <p id="current-group" style="font-size:22px;font-weight:bold;color:#007bff;"></p>
            <ol id="questions-list"></ol>
            <button id="next-group">Siguiente Grupo</button>
        </div>
    `;

    currentGroupIndex=0;
    document.getElementById('next-group').addEventListener('click', showNextQuestion);
    showNextQuestion();
}

/* Mostrar preguntas */
function showNextQuestion(){
    if(currentGroupIndex < totalGroups){
        const g = groupOrderFirstRound[currentGroupIndex];
        displayQuestion(g, questionsMap[g][0], 1);
        currentGroupIndex++;
    }
    else if(currentGroupIndex < 2*totalGroups){
        const g = groupOrderSecondRound[currentGroupIndex-totalGroups];
        displayQuestion(g, questionsMap[g][1], 2);
        currentGroupIndex++;
    }
    else{
        document.getElementById('next-group').style.display='none';
        document.getElementById('current-group').textContent='Finalizado.';
        document.getElementById('questions-list').innerHTML='';
    }
}

function displayQuestion(groupNumber,question,round){
    document.getElementById('current-group').textContent=`Grupo ${groupNumber} – Ronda ${round}`;
    document.getElementById('questions-list').innerHTML = `<li>${question}</li>`;
}

function shuffleArray(arr){
    for(let i=arr.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
}
</script>

</body>
</html>
